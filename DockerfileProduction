#----------------------------------------------------------------
# PRODUCTION 
#----------------------------------------------------------------

#
# Builder
#

FROM golang:1.17 AS builder

WORKDIR /go/src/api

# Download necessary Go modules

ENV GO111MODULE=on

COPY go.mod .

# Copy over the source files
COPY . .

RUN mv /go/src/api/.env.dist /go/src/api/.env

ENV GOOGLE_APPLICATION_CREDENTIALS=/go/src/api/application_default_credentials.json

RUN go mod vendor

RUN go mod download


CMD [ "go", "run", "github.com/docker-generator/api/cmd/httpserver"]